  name: Commit Stage
  on: push

  jobs:
    build:
      name: Build and Test
      runs-on: ubuntu-20.04
      permissions:
        contents: read
        security-events: read
      steps:
        - name: Checkout source code
          uses: actions/checkout@v3
        - name: Set up JDK 17
          uses: actions/setup-java@v3
          with:
            distribution: temurin
            java-version: 17
            cache: maven
        - name: Code vulnerability scanning
          uses: anchor/scan-action@v3
          id: scan
          with:
            path: ${{ github.workspace }}
            fail-build: false
            severity-cutoff: high
            acs-report-enabled: true
        - name: Upload vulnerability report
          uses: github/codeql-action/upload-sarif@v2
          if: success() || failure()
          with:
            sarif_file: ${{ steps.scan.outputs.sarif }}
        - name: Build, unit test and integration test
          run: |
            chmod +x mvnw
            ./mvnw clean verify
